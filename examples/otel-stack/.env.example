# AgentProxy Configuration for OTEL Stack Testing
# This is pre-configured for telemetry testing with the local OTEL stack
# Copy this file to .env and customize for your setup

# ============================================================================
# Core Configuration
# ============================================================================

# Gemini API Key (required for PA to work)
GEMINI_API_KEY=your-api-key-here

# Claude binary path (optional, defaults to 'claude' from PATH)
# Use this to specify a local build or specific version
#CLAUDE_BIN=/path/to/.claude/local/claude

# ============================================================================
# Telemetry Configuration (Pre-configured for OTEL stack)
# ============================================================================

# Enable OpenTelemetry instrumentation (0=disabled, 1=enabled)
# Set to 1 for testing with the OTEL stack
AGENTPROXY_ENABLE_TELEMETRY=1

# OTEL Collector endpoint (matches docker-compose services)
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317

# Service identification
OTEL_SERVICE_NAME=agentproxy
# OTEL_SERVICE_NAMESPACE will default to {user}.{project} if not set

# ============================================================================
# Multi-Tenant Configuration (Example values for testing)
# ============================================================================

# User/Owner ID - used for per-user metrics aggregation
# Defaults to current username if not set
AGENTPROXY_OWNER_ID=alice

# Project ID - used for per-project metrics aggregation
# Defaults to "default" if not set
AGENTPROXY_PROJECT_ID=example-project

# Role - supervisor (PA) or worker (Claude subprocess)
# Defaults to "supervisor" if not set
AGENTPROXY_ROLE=supervisor

# ============================================================================
# Claude Code OTEL Configuration (inherited by subprocess)
# ============================================================================

# Enable Claude Code's built-in telemetry
CLAUDE_CODE_ENABLE_TELEMETRY=1

# OTEL exporters for Claude Code
OTEL_METRICS_EXPORTER=otlp
OTEL_LOGS_EXPORTER=otlp
OTEL_EXPORTER_OTLP_PROTOCOL=grpc

# ============================================================================
# Advanced OTEL Configuration (Optional)
# ============================================================================

# Export intervals (milliseconds)
OTEL_TRACE_EXPORT_INTERVAL=1000    # Export traces every 1 second
OTEL_METRIC_EXPORT_INTERVAL=10000  # Export metrics every 10 seconds
OTEL_LOGS_EXPORT_INTERVAL=5000     # Export logs every 5 seconds

# TLS configuration (true=no TLS for localhost, false=use TLS for production)
OTEL_EXPORTER_OTLP_INSECURE=true

# Separate endpoints for traces and metrics (optional)
#OTEL_EXPORTER_OTLP_TRACES_ENDPOINT=http://localhost:4317
#OTEL_EXPORTER_OTLP_METRICS_ENDPOINT=http://localhost:4317

# ============================================================================
# Usage
# ============================================================================
# 1. Copy this file: cp .env.example .env
# 2. Edit .env with your GEMINI_API_KEY
# 3. Start the OTEL stack: docker-compose up -d
# 4. Load config: source .env (or run from examples/otel-stack directory)
# 5. Run PA from project root: cd ../.. && pa "create a hello world app"
# 6. View metrics: http://localhost:3000 (Grafana)
# 7. View traces: http://localhost:3200 (Tempo)
# 8. View raw metrics: http://localhost:9090 (Prometheus)
#
# Note: This .env is compatible with the root .env.example
# You can use either location - agentproxy CLI loads .env from current directory
